# pylint: disable=line-too-long
#!/usr/bin/env python3
"""
attest_sevsnp.py

Performs a raw attestation request to a SEV-SNP-enabled Azure Attestation instance
using a base64-encoded report and optional runtime data.

Writes the request and response details to a specified output file.

Requirements:
  - Python 3.6+
  - requests

Installation:
  pip install requests

Usage:
  python3 get-sevsnp-jwt.py --jwt-file jwt-file-name.txt
"""

import argparse
import time
import requests

INSTANCE_NAME = "instance.name"
ATTEST_URI = f"https://{INSTANCE_NAME}.attest.azure.net/attest/sevsnpvm?api-version=2022-08-01"
REPORT_SAMPLE = "eyJTbnBSZXBvcnQiOiJBZ0FBQUFJQUFBQWZBQU1BQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUFBQ0FBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFEQUFBQUFBQUkwZ0VBQUFBQUFBQUFBQUFBQUFBQUFBQkFfQ1NPeTFVQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBeEFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBc093MWI4ZEpXLWs0N1hlNzhCN1ZmOHZjQ2tJWHROUTlnbFpGQW9hVWZFeEIxTzZXckxBT2dVMnNjREJrNjlIYzVjN2VOY014b05UUW0zaGlOdGRfRmZsdDJiam1aTmZ0enBoRW42aWJTQ0JMTzlWWi1lT19LQnpfZWlKU3hnT3F1ODdWZ2hBa01aSGdyV3RVMnZQRUQwWlNSU3lLY3FzWEZRSXI4NlJfSVlBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFDcFNocDY2VzBHQXFuOHlVSXcwdlN3UmM5M3RGSW9CX1l3d1lyelpISXNUUF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX0F3QUFBQUFBQ0hNQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFzU2tndUcycEVUMk5IMEhxQzJwUVB5ZEpRTkNJeFljdk11T1FSMTF4aGc0V2Fub3pQQVBYcF9sZ3FtQVVETFNuY0RyaGlrRHVZSUlEVlF1dE51Y3lQQXdBQUFBQUFDSE1FTkFFQUJEUUJBQU1BQUFBQUFBaHpBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQV9IVHo1WVJvRW9SZkdWeDJWeDFUY2Y0SWFaRXZVTUxCMUtZSW41MllpWDN5ajdKQ3ZpMFE2QU9TYmNYdGxVa25BQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQXJxOWd0czJ3bUpBa0hLOVRwaFVvSkk4d0ZNckJTcWFYODgwdTVWR29Qdmtsc25CYzFXRnhtN2JzWFhrT3FPZTVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBIiwiVmNla0NlcnRDaGFpbiI6IkxTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdERRcE5TVWxHVkVSRFEwRjJkV2RCZDBsQ1FXZEpRa0ZFUWtkQ1oydHhhR3RwUnpsM01FSkJVVzkzVDJGQlVFMUJNRWREVjBOSFUwRkdiRUYzVVVOQloxVkJEUXB2VW5kM1IyZFpTa3R2V2tsb2RtTk9RVkZGU1UxQk1FZERWME5IVTBGR2JFRjNVVU5CWjFWQmIyZE5RMEZVUTJwQmQwbENRVlJDTjAxU1VYZEZaMWxFRFFwV1VWRk1SRUYwUm1KdFpIQmliVlpzWTIxc2RWcDZSVXhOUVd0SFFURlZSVUpvVFVOV1ZrMTRSa1JCVTBKblRsWkNRV05OUXpGT2FHSnVVbWhKUlU1ekRRcFpXRXBvVFZGemQwTlJXVVJXVVZGSlJFRktSRkZVUldaTlFqQkhRVEZWUlVObmQxZFJWMUl5V1ZjMWFscFhVV2RVVjJ4cVkyMDRaMUpIVmpKaFYwNXNEUXBqZWtWVFRVSkJSMEV4VlVWQmQzZEtWVEJXVjB4Vk1YQmlSMFoxVFVJMFdFUlVTWHBOUkZWNVRYcEJlazFFUlRCTmJHOVlSRlJOZDAxRVZYbE5la0Y2RFFwTlJFVXdUV3h2ZDJWcVJWVk5Ra2xIUVRGVlJVTjNkMHhTVnpWdVlWYzFiRnBZU25CaWJXTjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVNVWGRGWjFsRURRcFdVVkZJUkVGMFZGbFhOVEJaVTBKRVlrZEdlVmxVUlV4TlFXdEhRVEZWUlVOQmQwTlJNRVY0U0hwQlpFSm5UbFpDUVc5TlJtdEdhMlJ0Um5WWk1sWnJEUXBKUlRGd1dUTktka2xGVW14a2JXeHFXbGhOZUVWVVFWQkNaMDVXUWtGTlRVTkdUa1pXYVRGWFVUQldURTFJV1hkRlFWbElTMjlhU1hwcU1FTkJVVmxHRFFwTE5FVkZRVU5KUkZsblFVVlllR2haV1hONFRFUkNOVzk0ZDNoa0swNURWVEF2TWpNM09FVldUMVJLU21jd05GaDJSblpJY0RCQk4waE5WMHA0VlROQ0RRcFBNMXBqVFVOM1ltaG9UREZDTjJFM1VrOUpkemxHYUdjMVdGbDRVMnAwVDBGWGRVODRka0pMVkc5Qk5EazFhVWhRVkhKUGNFbG1SM2RGVjJ4a01tRm1EUXBoUzNWaWVtaDZNVVJrTm1Wdk5FbENSbXBEUTBGU1NYZEZRVmxLUzNkWlFrSkJSMk5sUVVWQ1FrRk5RMEZSUVhkR2QxbEtTM2RaUWtKQlIyTmxRVVZERFFwQ1FXOVhRMFV4Y0dKSFJuVk1WVWwzVFVKRlIwTnBjMGRCVVZGQ2JraG5Ra0YzUlVWQmQwbENRWHBCVWtKbmIzSkNaMFZGUVZwNE5FRlJUVU5DUVUxRERRcEJVVUYzUlZGWlMwdDNXVUpDUVVkalpVRkZSRUpCVVVSQlowVkJUVUpGUjBOcGMwZEJVVkZDYmtoblFrRjNWVVZCZDBsQ1FVUkJVa0puYjNKQ1owVkZEUXBCV25nMFFWRk5SMEpCVFVOQlVVRjNSVkZaUzB0M1dVSkNRVWRqWlVGRlJFSjNVVVJCWjBWQlRVSkZSME5wYzBkQlVWRkNia2huUWtGM1RVVkJkMGxDRFFwRFJFRlNRbWR2Y2tKblJVVkJXbmcwUVZGTlNVSkJUVU5CV0UxM1ZGRlpTa3QzV1VKQ1FVZGpaVUZGUlVKRlFYTlRhMmQxUnpKd1JWUXlUa2d3U0hGRERRb3ljRkZRZVdSS1VVNURTWGhaWTNaTmRVOVJVakV4ZUdobk5GZGhibTk2VUVGUVdIQXZiR2R4YlVGVlJFeFRibU5FY21ocGEwUjFXVWxKUkZaUmRYUk9EUXAxWTNsUVRVVlpSME5UY1VkVFNXSXpSRkZGUWtOcVFUVnZRVGgzUkZGWlNsbEpXa2xCVjFWRVFrRkpRMEpSUTJoSVJFRmhRbWRyY1docmFVYzVkekJDRFFwQlVXZDNSRkZaU2xsSldrbEJWMVZFUWtGSlEwSlJRMmxCZDBsQ1RVdE5SRUZuUlVKQk5FbERRVkZEU0dkelFWVlBVRVZtVEc0d1oxUlhWR0ZWYlVWWURRcFpWRFExUW5kV1FtTjJhVXBWUTBzd09XWk9Nemd2VTBKUVQyYzBWMlZFVUhOT2RFTmxNM0ZqVmxGU0wxQnpSaXRYU2tSUllXRllTbVZHU1RSV1Vsa3dEUXB2Tm5OS1ZURXhNa0phY2pGUlNuaFZaM2NyVTBwWVkxaEZZV2hKV1U5RlozUnlSREo1TVM5RFVFRllUM05ETDBSNWNrZEVRMU00Y0ZaYVJFaHdZbEZIRFFwcGFGUXphaTlpWlcwd01IcElUbTB5TUZZNU5YZFhkemN2ZDA5YU5qUllOVUkwYlZrdlMweHpWM1ZsY1ZGTlZGY3JNbkJ4V1VWalNEbEVURUZwU0UxMURRbzFhMXA0WWpKNFJFRXhOMUkyVGtGcU1IaFRNbEZ1UVVOQ1lrTldVR2hVWWxSMFJXOHdUVkZXUjA4M1kwWnVPRTlKU1hWM2JWcGFTazkzZVV4bmRHWmtEUXBSVDA5VlVuUlhVbnBXU0hkT2NuZHFWRGhTTjNkVlZVNTZSa3hEUlUxaFRXZ3pXalpwZEdsdVYwMDRVbWh5UW5CcU1YRnJSVlpSY1ZvelJtZE1NWGhwRFFweFJrRnVWRVpYYjFKRmJqTlVTelZuWW5BMWVteEphVkozUzNKVGNXeGtRMWsxZW5Cd1FVVTNURzlGYWpOU1lXZElRMmhGTDJveVlqUlpLMkpzUTJzeERRcExVbUZsZFVkeFF6ZGpiVXBZV2xWalVIQXdiMm81TTNsd05IUmlkVEkwZVVoUk9XZEJlbk5tWjNORGQyTmtWV1pEVUdrNFUwOWhkWEp2TDNoTVNIa3pEUXBMTjI5NmExaGFibFV4TjFkSWFUTnVObVJHWTB4R2FGVlphM2R6TTJFck0wWnVMMjFxTVVRck1FbHNOMmN4VDFkaVNHVnNkM0JSYlVKeE4xcHdOMlpyRFFwVVNraG5aVEJ3UVZGelJWRktRVGxxUTJ0bEwwOHZiRUZ5Umt4d2JHSjRNblIwUTFSWFVYTm9NWFowZGtsNU5VaFRielZVVEZKblduSldaalZMTUhseERRcHZUMVIzVEZCNldpdFNlblk0TUdsbFNVZHlNM2RET0VJNFFUUnFPR05YVVVSb2VHdFRjQzlsUmk5cGJIVjNXVzAyYTA5dVowSllOV0ZqYkVVelRVRXlEUXBCWTBwaFVsUmxZMHhuTURWeFRHbzBUR1p1ZUZCblBUME5DaTB0TFMwdFJVNUVJRU5GVWxSSlJrbERRVlJGTFMwdExTME5DaTB0TFMwdFFrVkhTVTRnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUTBLVFVsSlIybFVRME5DUkdsblFYZEpRa0ZuU1VSQlVVRkNUVVZaUjBOVGNVZFRTV0l6UkZGRlFrTnFRVFZ2UVRoM1JGRlpTbGxKV2tsQlYxVkVRa0ZKUXcwS1FsRkRhRWhFUVdGQ1oydHhhR3RwUnpsM01FSkJVV2QzUkZGWlNsbEpXa2xCVjFWRVFrRkpRMEpSUTJsQmQwbENUVXROUkVGblJVSk5TSE40UmtSQlV3MEtRbWRPVmtKQmMwMURNRloxV2pKc2RWcFhWbmxoVnpWdVRWRnpkME5SV1VSV1VWRkhSWGRLVmxWNlJWVk5Ra2xIUVRGVlJVSjNkMHhWTWtaMVpFZEZadzBLVVRKNGFHTnRSWGhEZWtGS1FtZE9Wa0pCWjAxQmEwNUNUVkk0ZDBoUldVUldVVkZMUkVKYVFscElXbWhpYlU1c1drTkNUbUZYVG5saWVVSkZXbGhhY0EwS1dUSldlazFTU1hkRlFWbEVWbEZSUkVSQmJFSlZhM04wVkZkc2MxbFhOSGRJYUdOT1RXcEJlRTFFU1hsTlZHZDVUa1JKZDFkb1kwNU9SRlY0VFVSSmVRMEtUVlJuZVU1RVNYZFhha0kzVFZKUmQwVm5XVVJXVVZGTVJFRjBSbUp0WkhCaWJWWnNZMjFzZFZwNlJVeE5RV3RIUVRGVlJVSm9UVU5XVmsxNFJrUkJVdzBLUW1kT1ZrSkJZMDFETVU1b1ltNVNhRWxGVG5OWldFcG9UVkZ6ZDBOUldVUldVVkZKUkVGS1JGRlVSV1pOUWpCSFFURlZSVU5uZDFkUlYxSXlXVmMxYWcwS1dsZFJaMVJYYkdwamJUaG5Va2RXTW1GWFRteGpla1ZUVFVKQlIwRXhWVVZCZDNkS1ZUQldWMHhWTVhCaVIwWjFUVWxKUTBscVFVNUNaMnR4YUd0cFJ3MEtPWGN3UWtGUlJVWkJRVTlEUVdjNFFVMUpTVU5EWjB0RFFXZEZRVzVWTW1SeWNrNVVabUpvVGxGSmJHeG1LMWN5ZVN0U1QwTmlVM3BKWkRGaFMxcG1kQTBLTWxRNWVtcGFVVTk2YWtkalkyd3hOMmt4YlVsTFYydzNUbFJqUWpCV1dWaDBNMHA0V2xONlQxcHFjMnBNVGxaQlJVNHlUVWRxT1ZScFpXUk1LMUZsZHcwS1MxcFlNRXB0VVVWMVdXcHRLMWRMYTNOTWRIaG5aRXh3T1VVM1JWcE9kMDVFY1ZZeGNqQnhVbEExZEVJNFQxZHJlVkZpU1dSTVpYVTBZVU42TjJvdlV3MEtiREZHYTBKNWRHVjJPWE5pUmtkNmREZGpkMjVxZW1rNWJUZHViM0Z6YXl0MVVsWkNjRE1yU1c0ek5WRlFaR05xT0ZsbWJFVnRia2hDVG5aMVZVUkthQTBLVEVOS1RWYzRTMDlxVURZcksxQm9Zbk16YVVOcGRFcGpRVTVGZEZjMGNWUk9SbTlMVnpORFNHeGlZMU5EYWxSTk9FdHpUbUpWZUROQk9HVnJOVVZXVEEwS2FscFhTREZ3ZERsRk0xUm1jRkkyV0hsbVVVdHVXVFpyYkRWaFJVbFFkMlJYTTJWR1dXRnhRMFpRY2tsdk9YQlJWRFpYZFVSVFVEUktRMWxLWWxwdVpRMEtTMHRKWWxwcWVsaHJTblF6VGxGSE16SkZkV3RaU1cxQ1lqbFRRMnR0T1N0bVV6Vk1Xa1puT1c5cWVuVmlUVmd6SzA1clFtOVRXRWszVDFCMmJraE5lQTBLYW5Wd09XMTNOWE5sTmxGVlZqZEhjWEJEUVRKVVRubHdiMnh0ZFZFclkwRmhlRlkzU25GSVJUaGtiRGx3VjJZcldUTmhjbUlyT1dscFJrTjNSblEwYkEwS1FXeEtkelZFTUVOVVVsUkRNVmsxV1ZkR1JFSkRja0V2ZGtkdWJWUnVjVWM0UXl0cWFsVkJVemRqYW1wU09IRTBUMUJvZVVSdFNsSlFibUZETDFwSE5RMEtkVkF3U3pCNk5rZHZUeTh6ZFdWdU9YZHhjMmhEZFVobFoweFVjRTlsU0VWS1VrdHlVVVp5TkZCV1NYZFdUMEl3SzJWaVR6VkdaMjk1VDNjME0yNTVSZzBLUkRWVlMwSkVlRVZDTkVKTGJ5OHdkVUZwUzBoTVVuWjJaMHhpVDFKaVZUaExRVkpKY3pGRmIzRkZhbTFHT0ZWMGNtMVJWMVl5YUZWcWQzcHhkM1pJUmcwS1pXazRjbEI0VFVOQmQwVkJRV0ZQUW05NlEwSnZSRUZrUW1kT1ZraFJORVZHWjFGVlR6aGFkVWREY2tRdlZERnBXa1ZwWWpRM1pFaE1URlE0ZGk5bmR3MEtTSGRaUkZaU01HcENRbWQzUm05QlZXaGhkMkV3VlZBemVVdDRWakZOVldSUlZXbHlNVmhvU3pGR1RYZEZaMWxFVmxJd1ZFRlJTQzlDUVdkM1FtZEZRZzBLTDNkSlFrRkVRVTlDWjA1V1NGRTRRa0ZtT0VWQ1FVMURRVkZSZDA5bldVUldVakJtUWtSTmQwMVVRWFp2UXpKblN6UlpjR0ZJVWpCalNFMDJUSGs1Y2cwS1draE9jR0p1VW0xTWJVWjBXa00xYW1JeU1IWmtiVTVzWVhrNU1rMVRPVTVoVjNob1ltazVhbU50ZDNkU1oxbEtTMjlhU1doMlkwNUJVVVZMVFVSdFp3MEtSSHBCVGtKbmJHZG9hMmRDV2xGTlJVRm5TVVpCUzBWalRVSnZSME5UY1VkVFNXSXpSRkZGUWtORVFVNUNaMnhuYUd0blFscFJUVVZCWjBsR1FVdEpSQTBLUVdkRmQyOTNUVU5CVVVWRVoyZEpRa0ZKWjJWVlVWTmpRV1l6YkVSWmNXZFhWVEZXZEd4RVltMUpUamhUTW1SRE5XdHRVWHB6V2k5SWRFRnFVVzVNUlEwS1VFa3hhbWd6WjBwaVRIaE1ObWRtTTBzNGFuaGpkSHBQVjI1cldXTmlaR1pOVDA5eU1qaExWRE0xU1dGQlVqSXdjbVZyUzFKR2NIUlVTR2hsSzBSR2NnMEtNMEZHZWxwTVJFUTNZMWRMTWprdlIzQlFhWFJRU2tSTFEzWkpOMEUwVldjd05uSnJOMG93ZWtKbE1XWjZMM0ZsTkdreUwwWXhNbkoyWm5kRFIxbG9ZdzBLVW5oUWVUZFJSak54T0daU05rZERTbVJDTVZWUk5WTnNkME5xUm5oRU5IVmxlbFZTZW5SSmJFbEJhazFyZERkRVJuWkxVbWdyTW5wTEt6VndiRlpIUncwS1JuTnFSRXAwVFhveWRXUTVlVEJ3ZGs5Rk5Hb3paRWcxU1ZjNWFrZDRZVk5IVTNSeFRuSmhZbTV1Y0VZeU16WkZWSEl4TDJFME0ySTRSa1pMVERWUlRnMEtiWFE0Vm5JNWVHNVlVbkI2Ym5GRFVuWnhhbklyYTFaeVlqWmtiR1oxVkd4c2FWaGxVVlJOYkVKdlVsZEdTazlTVERoQlkwSktlRWRhTkVzeWJWaG1kQTBLYkRGcVZUVlVUR1ZvTlV0WVREbE9WemRoTDNGQlQwbFZjekpHYVU5b2NYSjBla0ZvU2xKbk9VbHFPRkZyVVRsUWF5dGpTMGQ2ZHpaRmJETlVNMnRHY2cwS1JXYzJlbXQ0YlhaTmRXRmlXazl6WkV0bVVtdFhabWhJTWxwTFkxUnNSR1p0U0RGSU1IcHhNRkV5WWtjemRYWmhWbVJwUTNSR1dURk1iRmQ1UWpNNFNnMEtVekptVG5OU0wxQjVOblExWW5KRlNrTkdUblo2WVVScmVUWkxaVU0wYVc5dUwyTldaMVZoYVRkNmVsTXpZa2RSVjNwTFJFdFZNelZUY1U1Vk1sZHJVQTBLU1RoNFExb3dNRmQwU1dsTFMwWnVXRmRWVVhoMmJFdHRiV2RhUWtsWlVHVXdNWHBFTUU0NFlYUkdlRzFYYVZOdVprcHNOamt3UWpseVNuQk9VaTltU1EwS1lXcDRRMWN6VTJWcGQzTTJjakZhYlN0MFEzVldZazFwVG5Sd1V6bFVhR3BPV0RSMWRtVTFkR2g1WmtVeVJHZHZlRkpHZGxreFEzTnZSalZORFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0RFFvdExTMHRMVUpGUjBsT0lFTkZVbFJKUmtsRFFWUkZMUzB0TFMwTkNrMUpTVWRaZWtORFFrSkxaMEYzU1VKQlowbEVRVkZCUVUxRldVZERVM0ZIVTBsaU0wUlJSVUpEYWtFMWIwRTRkMFJSV1VwWlNWcEpRVmRWUkVKQlNVTU5Da0pSUTJoSVJFRmhRbWRyY1docmFVYzVkekJDUVZGbmQwUlJXVXBaU1ZwSlFWZFZSRUpCU1VOQ1VVTnBRWGRKUWsxTFRVUkJaMFZDVFVoemVFWkVRVk1OQ2tKblRsWkNRWE5OUXpCV2RWb3liSFZhVjFaNVlWYzFiazFSYzNkRFVWbEVWbEZSUjBWM1NsWlZla1ZWVFVKSlIwRXhWVVZDZDNkTVZUSkdkV1JIUldjTkNsRXllR2hqYlVWNFEzcEJTa0puVGxaQ1FXZE5RV3RPUWsxU09IZElVVmxFVmxGUlMwUkNXa0phU0Zwb1ltMU9iRnBEUWs1aFYwNTVZbmxDUlZwWVduQU5DbGt5Vm5wTlVrbDNSVUZaUkZaUlVVUkVRV3hDVld0emRGUlhiSE5aVnpSM1NHaGpUazFxUVhoTlJFbDVUVlJqZVUxNlFURlhhR05PVGtSVmVFMUVTWGtOQ2sxVVkzbE5la0V4VjJwQ04wMVNVWGRGWjFsRVZsRlJURVJCZEVaaWJXUndZbTFXYkdOdGJIVmFla1ZNVFVGclIwRXhWVVZDYUUxRFZsWk5lRVpFUVZNTkNrSm5UbFpDUVdOTlF6Rk9hR0p1VW1oSlJVNXpXVmhLYUUxUmMzZERVVmxFVmxGUlNVUkJTa1JSVkVWbVRVSXdSMEV4VlVWRFozZFhVVmRTTWxsWE5Xb05DbHBYVVdkVVYyeHFZMjA0WjFKSFZqSmhWMDVzWTNwRlUwMUNRVWRCTVZWRlFYZDNTbEZXU2t4TVZURndZa2RHZFUxSlNVTkpha0ZPUW1kcmNXaHJhVWNOQ2psM01FSkJVVVZHUVVGUFEwRm5PRUZOU1VsRFEyZExRMEZuUlVFd1RHUTFNbEpLVDJSbGFVcHNjVXN5U21SelZtMUVOMFpyZEhWdmRGZDNXREZtVG1jTkNsYzBNVmhaT1ZoNk1VaEZhRk5WYldoTWVqbERkVGxFU0ZKc2RtZEtVMDU0WW1WWldYTnVTbVoyZVdwNE1VMW1WVEJXTlhSclMybFZNVVZsYzA1R2RHRU5DakZyVkVFd2MzcE9hWE5rV1dNNWFYTnhhemR0V0ZRMUswdG1SMUppWm1NMFZpODVlbEpKWTBVNGFteElUall4VXpGcWRUaFlPVE1yTm1SNFJGVnlSeklOQ2xONmVIRktORUpvY1hsWmJWVkVjblZRV0VwVFdEUjJWV013TVZBM2FqazRUWEJ4VDFNNU5YSlBVbVJIU0dWSk5USk9ZWG8xYlRKQ0swOHJkbXB6UXpBTkNqWXdaRE0zYWxrNVRFWmxkVTlRTkUxbGNtazRjV2RtYVRKVE5XdExjV2N2WVVZMllWQjBkVUZhVVZaU04zVXpTMFpaV0ZBMU9WaHRTbWQwWTI5bk1EVU5DbWR0U1RCVUwwOXBkRXhvZFhwV2RuQmFZMHh3YURCdlpHZ3ZNVWxRV0hGNE15dE5ibXBFT1RkQk4yWlljSEZIWkM5NU9FdDRXRGRxYTNOVVJYcEJUMmNOQ21KTFFXVmhiVE5zYlNzemVVdEpZMVJaVFd4elVrMVlVR05xVG1KSmRtMXpRbmxyUkM4dmVGTnVhWFZ6ZFVoQ2EyZHViRVZPUlZkNE1WVmpZbEZSY25NTkNpdG5Wa1JyZFZaUWFITnVla2xTVG1kWmRrMDBPRmtyTjB4SGFVcFpibkp0UlRoNFkzSmxlR1ZyUW5oeWRtRXlWamxVU2xGeGJrNHpVVFV6YTNRMWRta05DbEZwTXl0blEyWnRhM2RETUVZd2RHbHlTVnBpVEd0WVVISlFkM3BhTUUwNVpVNTRhRWw1VTJJeWJuQktabWR1Y1hvMU5Va3dkVE16ZDJnMGNqQmFUbEVOQ21WVVIyWjNNRE5OUWxWMGVYVjZSMlZ6UjJ0amR5dHNiM0ZOWVhFeGNWSTBkR3BIWWxCWmVFTjJjRU54Tnl0UFozQkRRMjlOVG1sME1uVk1iemxOTVRnTkNtWkllakV3YkU5TlZEaHVWMEZWZGxKYVJucDBaVmhEYlNzM1VFaGtXVkJzYlZGM1ZYY3pUSFpsYmtvdlNVeFliMUZRU0daaWEwZ3dRM2xRWm1oc01Xb05DbGRvU2taYVlYTkRRWGRGUVVGaFRpdE5TSGQzUkdkWlJGWlNNRkJCVVVndlFrRlJSRUZuUlVkTlFqQkhRVEZWWkVSblVWZENRbE5HY2tKeVVsRXZaa2tOQ25KR1dGVjRVakZDVTB0MlZtVkZjbFZWZWtGUVFtZE9Wa2hTVFVKQlpqaEZRbFJCUkVGUlNDOU5SRzlIUVRGVlpFaDNVWHBOUkVWM1REWkJkRzlEZFVjTkNrdFhhREJrU0VKNlQyazRkbUV5VW5waFZ6VXdXbWsxYUdKWFVYVlpNamwwVEROYWFscFhjM1prYWtWMlZGZHNjMWxYTkhaWk0wcHpUVVZaUjBOVGNVY05DbE5KWWpORVVVVkNRMnBCTlc5Qk9IZEVVVmxLV1VsYVNVRlhWVVJDUVVsRFFsRkRhRWhFUVdGQ1oydHhhR3RwUnpsM01FSkJVV2QzUkZGWlNsbEpXa2tOQ2tGWFZVUkNRVWxEUWxGRGFVRjNTVUpOUzAxRVFXZEZRa0UwU1VOQlVVTTJiVEJyUkhBMmVuWTBUMnBtWjNrcmVteGxaV2h6ZURadmJEQnZZMmRXWld3TkNrVlViMkp3ZUN0RmRVTnpjVlpHVWxCTE1XcGFNWE53TDJ4NVpEa3JNR1pSTUhJMk5tNDNhMkZuVW1zMFEyRXpPV2MyTmxkSFZFcE5aVXBrY1ZseWFYY05DbE5VYW1wRVEwdFdVRk5sYzFkWVdWQldRWGxFYUcxUU5XNHlkaXRDV1dsd1dsZG9jSFp4Y0dGcFR5dEZSMHMxU1VKUUt6VTNPRkZsVnk5elUyOXJja3NOQ21SSVlVeEJlRWN5VEdoYWVHbzVZVVkzTTJaeFF6ZFBRVXBhTldGUWIyNTNORkpGTWprNVJsWmhjbWd4VkhneVpWUXpkMU5uYTBSbmRYUkRWRUl4V1hFTkNucFVOVVIxZDNaQlpTdGpiekpEU1ZaSmVrMUVZVzFaZFZOR2FsQk9NRUpEWjI5cWJEZFdLMkpVYjNVM1pFMXpjVWwxTDFSWEwzSlFRMWc1TDBWVlkzQU5Da3RIUzNGUVVUTlFLMDQ1Y2pGb2FrVkdXVEZ3YkVKbk9UTjBOVE5QVDI4ME9VZE9TU3RXTVhwMldGQk1TVFo0U1VaV2MyZ3JiWFJ2TWxKMFowVllMMlVOQ25CdFRVdFVUazQyY0hOWE9EaHhaemRqTVdoVVYzUk9OazFpVW5WUk1IWnRLMDhyTHpKMFMwSkdNbWc0VkVoaU9UUlBkblpJU0c5R1JIQmlRMFZNYkhFTkNraHVTVmxvZUhrd1dVdFlSM2xoVnpGT2FtWlZUSGh5Y20xNFZsYzBkMk51TlVVNFIyUmtiWFpPWVRaNVdXMDRjMk5LWVdkRmFURXpiV2hIZFRSS2NXZ05Dak5SVlROelpqaHBWVk5WY2pBNWVGRkVkMGgwVDFGVlZrbHhlRFJ0WVVKYVVFSjBVMDFtSzNGVlJIUnFXRk5UY1Roc1psZGpaRGhpVEhJNWJXUnpWVzROQ2twYVNqQXJkSFZRVFV0dFFtNVRTRGcyTUd4c1Myc3JWbkJXVVhObmNXSjZSRWwyVDB4MlJEWlhNVlZ0Y1RJMVltOTRRMWxLSzFSMVFtOWhOSE1yU0VnTkNrTldhVUYyWjFRNWEyWXZja0p4TVdRcmFYWnFObk5yYTBoNGRYcGplR0pyTVhoMk5scEhlSEowWlVwNFZrZzNTMnhZTjFsU1pGbzJaVUZTUzNkTVpUUU5Da0ZHV2tWQmQyOUxRMUU5UFEwS0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFEwSyJ9"
RUNTIME_DATA_SAMPLE = "eyJrZXlzIjpbeyJraWQiOiJIQ0xUcmFuc2ZlcktleSIsImtleV9vcHMiOlsiZW5jcnlwdCJdLCJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsIm4iOiJ1cjA4RGNjakdHelJvM09JcTQ0NW4wMFEzT3RoTUliUjNTV0l6Q2NpY0lNXzduUGlWRjVOQklrbmsyemRIWk4xaWlOaEl6SmV6clhTcVZUN1R5MURsNEFCNXhpQUFxeG83eEdqRnFsTDQ3TkE4V2JaUk14UXR3bHNPalpnRnhvc0ROWEl0NmRNcTdPRGg0bmo2blYySk1TY05mUkt5cjFYRklVSzBYa09XdlZsU2xOWmphQXhqOEg0cFMweU5mTndyMVE5NFZkU24zTFBSdVpCSEU3VnJvZkhSR1NISnJhRGxsZktUMC04b0tXOEVqcE13djFNRV9PZ1BxUHdMeWlSenI5OW1vQjd1eHpqRVZEZTU1RDJpMm1QcmNtVDdrU3NId3A1TzJ4S2hNNjhyZGE2Ri1JVDIxSmdkaFE2bjRIV0NpY3NsQm14NG9xa0kteDVsVnNSa1EifV0sInZtLWNvbmZpZ3VyYXRpb24iOnsic2VjdXJlLWJvb3QiOnRydWUsInNlY3VyZS1ib290LXRlbXBsYXRlLWlkIjoiMTczNGM2ZTgtMzE1NC00ZGRhLWJhNWYtYTg3NGNjNDgzNDIyIiwidHBtLWVuYWJsZWQiOnRydWUsInZtVW5pcXVlSWQiOiJBRTVDQkIyQS1EQzk1LTQ4NzAtQTc0QS1FRTRGQjMzQjFBOUMifX0"
RUNTIME_DATA_TYPE = "JSON"
REQUEST_TIMEOUT_SECONDS = 10


def attest_sevsnp(output_file):
    """Sends a SEV-SNP attestation request and writes the resulting JWT token to the specified file."""
    headers = {
        "Content-Type": "application/json"
    }

    payload = {
        "report": REPORT_SAMPLE,
     #   "runtimeData": {
     #       "data": RUNTIME_DATA_SAMPLE,
     #       "dataType": RUNTIME_DATA_TYPE
     #   }
    }

    print(f"Attestation endpoint: {ATTEST_URI}")
    print(f"Writing token to: {output_file}")

    start_time = time.time()
    response = requests.post(ATTEST_URI, headers=headers, json=payload, timeout=REQUEST_TIMEOUT_SECONDS)
    duration = round(time.time() - start_time, 2)

    print(f"HTTP {response.status_code}: {response.text}")
    if not response.ok:
        print("Attestation request failed.")
        return

    result = response.json()
    token = result.get("token")

    if not token:
        print("No token found in the response.")
        return

    with open(output_file, "w", encoding="utf-8") as f:
        f.write(token)

    print("Attestation completed successfully.")
    print(f"Duration: {duration} seconds")
    print(f"Token successfully written to '{output_file}'.")

def main():
    """Parses command-line arguments and initiates the attestation request."""
    parser = argparse.ArgumentParser(description="Call SEV-SNP attestation and dump JWT.")
    parser.add_argument("--jwt-file", default="jwt.txt", help="Path to write the attestation JWT. Defaults to jwt.txt.")
    args = parser.parse_args()

    attest_sevsnp(args.jwt_file)

if __name__ == "__main__":
    main()
